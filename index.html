<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SHT Hash Table: SHT Hash Table</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SHT Hash Table
   </div>
   <div id="projectbrief">SHT Hash Table</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect" class="search-icon" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"><span class="search-icon-dropdown"></span></span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><div id="MSearchCloseImg" class="close-icon"></div></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SHT Hash Table </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_2overview"></a></p>
<h1 class="doxsection"><a class="anchor" id="overview"></a>
Overview</h1>
<p>This library implements a simple hash table that can be used as a dictionary or set implementation in C programs. It uses a "Robin Hood" probing algorithm, which is described <a href="https://github.com/ipilcher/sht/blob/main/docs/robin-hood.md">here</a>.</p>
<h1 class="doxsection"><a class="anchor" id="design-philosophy"></a>
Design philosophy</h1>
<p>This library aims to provide a straightforward hash table implementation that is both readily understandable and suitable for most hash table use cases. Maximum possible performance and scabability are not design goals.</p>
<p>Also, the library provides no explicit support for concurrency. Any use of the library in a multi-threaded application will require external synchronization.</p>
<p>The library takes a "fail fast" approach to logic errors in the calling program. The calling program will be aborted if it violates the library's API contract. (See <a class="el" href="#abort-conditions">Abort conditions</a> below.) This frees the calling program from the need to check for and react to unrecoverable programming errors.</p>
<h1 class="doxsection"><a class="anchor" id="limits-and-assumptions"></a>
Limits and assumptions</h1>
<p>This library is developed on Linux with GCC (15.2.1 as of this writing). It makes use of a number of GCC builtins and C23 features. It should also work with Clang.</p>
<p>The library imposes a number of limits.</p>
<ul>
<li>The absolute maximum number of buckets in a table is 2²⁴ (16,777,216). At the default load factor threshold (LFT) of 85%, this results in a maximum usable capacity of 14,260,633 entries.</li>
<li>The maximum size of an entry is 16 KiB (16,384 bytes).</li>
<li>The maximum probe sequence length (PSL) of an entry is 127. (See <a href="https://github.com/ipilcher/sht/blob/main/docs/robin-hood.md"><em>Robin Hood hashing</em></a> and <a href="https://github.com/ipilcher/sht/blob/main/docs/psl-limits.md"><em>PSL Limits</em></a> for a discussion of PSLs.)</li>
<li>The maximum number of read-only iterators an a table is 32,767.</li>
</ul>
<p>In addition to the limits imposed by the library, the total size of a table is limited by the amount of memory available to the application. A table's total memory footprint scales with the product of the number of buckets and the entry size (i.e. <span class="tt">total_size ∝ buckets × entry_size</span>), so the largest possible table will not fit in the 4 GiB address space of a 32-bit system.</p>
<h1 class="doxsection"><a class="anchor" id="usage"></a>
Usage</h1>
<p>The basic usage pattern is:</p>
<ul>
<li>Create a table &mdash; <span class="tt"><a class="el" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0" title="Create a new hash table.">SHT_NEW()</a></span>,</li>
<li>If necessary, set any non-default table attributes &mdash; <span class="tt"><a class="el" href="sht_8c.html#a9d385ed61d95d30e63344ebe6aa522a3" title="Set the &quot;context&quot; for a table&#39;s equality function.">sht_set_eq_ctx()</a></span>, <span class="tt"><a class="el" href="sht_8c.html#a99d607b370024be6526a17863ee62145" title="Set the load factor threshold for a table.">sht_set_lft()</a></span>, <span class="tt"><a class="el" href="sht_8c.html#aae724bd6d23b2cc6921fe638c75c1b48" title="Set the &quot;context&quot; for a table&#39;s free function.">sht_set_free_ctx()</a></span>, etc.,</li>
<li>Initialize the table &mdash; <span class="tt"><a class="el" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd" title="Initialize a hash table.">sht_init()</a></span>,</li>
<li>Use the table &mdash; <span class="tt"><a class="el" href="sht_8c.html#a5cd47d066198640b242e7a1ecebab92e" title="Add an entry to the table, if its key is not already present.">sht_add()</a></span>, <span class="tt"><a class="el" href="sht_8c.html#a0dd66cb8cf354a570429662675bc6485" title="Lookup an entry in a table.">sht_get()</a></span>, <span class="tt"><a class="el" href="sht_8c.html#a82f0e05af3fc1174b3ff844ad1511362" title="Create a new iterator.">sht_iter_new()</a></span>, etc., and</li>
<li>Free the table &mdash; <span class="tt"><a class="el" href="sht_8c.html#ae36e072969cef119b1176887dcdc8623" title="Free the resources used by a hash table.">sht_free()</a></span>.</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="table-examples"></a>
Table examples</h2>
<p>To create a hash table, the following are required.</p>
<ul>
<li>An entry type to be stored in the table. This will usually be a data structure that contains both a key and a value. If the table will be used as a set rather than a dictionary, an entry will only contain a key, so it may be a primitive type.</li>
<li>A function that calculates the hash value of a key &mdash; the "hash
  function."</li>
<li>A function that compares two keys (one of which is inside an entry) for equality &mdash; the "equality function."</li>
<li>In some cases, a "free function" is required. The library calls the free function to release the resources associated with an entry that is being deleted from the table. (See <a class="el" href="#memory-management">Memory management</a> below.)</li>
</ul>
<blockquote class="doxtable">
<p><b>NOTE</b></p>
<p>The examples in this section omit error checking. </p>
</blockquote>
<h3 class="doxsection"><a class="anchor" id="example-1"></a>
Example 1</h3>
<p>This example shows the simplest possible usage &mdash; a set of integers.</p>
<ul>
<li>The keys are integers (type <span class="tt">int</span>).</li>
<li>This is a set, rather than a dictionary, so there are no values.</li>
<li>Thus, each entry is simply an <span class="tt">int</span>; no structure is required.</li>
</ul>
<div class="fragment"><div class="line">uint32_t int_hash(<span class="keyword">const</span> <span class="keywordtype">void</span> *restrict key, <span class="keywordtype">void</span> *restrict)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> *i = key;</div>
<div class="line">    <span class="keywordflow">return</span> (uint32_t)XXH3_64bits(i, <span class="keyword">sizeof</span> *i);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">_Bool int_eq(<span class="keyword">const</span> <span class="keywordtype">void</span> *restrict key, <span class="keyword">const</span> <span class="keywordtype">void</span> *restrict entry,</div>
<div class="line">             <span class="keywordtype">void</span> *restrict)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> *i1 = key;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> *i2 = entry;</div>
<div class="line">    <span class="keywordflow">return</span> *i1 == *i2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>sht_ht *int_set(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>sht_ht *ht;</div>
<div class="line"> </div>
<div class="line">    ht = <a class="code hl_define" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0">SHT_NEW</a>(int_hash, int_eq, NULL, <span class="keywordtype">int</span>);</div>
<div class="line">    <a class="code hl_function" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd">sht_init</a>(ht, 0);  <span class="comment">// default initial capacity</span></div>
<div class="line">    <span class="keywordflow">return</span> ht;</div>
<div class="line">}</div>
<div class="ttc" id="asht_8c_html_a4eaf764fc86d5f9428d6763f3aecadcd"><div class="ttname"><a href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd">sht_init</a></div><div class="ttdeci">bool sht_init(struct sht_ht *ht, uint32_t capacity)</div><div class="ttdoc">Initialize a hash table.</div><div class="ttdef"><b>Definition</b> <a href="sht_8c_source.html#l00536">sht.c:536</a></div></div>
<div class="ttc" id="asht_8h_html_aff395306d3299b2e23d1ec5dfb0b70d0"><div class="ttname"><a href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0">SHT_NEW</a></div><div class="ttdeci">#define SHT_NEW(hashfn, eqfn, freefn, etype,...)</div><div class="ttdoc">Create a new hash table.</div><div class="ttdef"><b>Definition</b> <a href="sht_8h_source.html#l00419">sht.h:419</a></div></div>
</div><!-- fragment --><p>Note the following.</p>
<ul>
<li>This example uses<a href="https://xxhash.com/doc/v0.8.3/group___x_x_h3__family.html"><span class="tt">XXH3_64bits()</span></a> as its underlying hash function. <a href="https://xxhash.com/doc/v0.8.3/group___x_x_h3__family.html"><span class="tt">XXH3_64bits()</span></a> returns a 64-bit hash value, but the upper 32 bits are discarded. In fact, the library will only use the lower 24 bits of the hash value, so it is imperative that the hash function performs adequate bit mixing.</li>
<li>Neither the hash function or the equality function makes use of any context.</li>
<li>A hash table must be initialized (<span class="tt"><a class="el" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd" title="Initialize a hash table.">sht_init()</a></span>) before it can be used.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="example-2"></a>
Example 2</h3>
<p>This example creates a dictionary that maps host names to IP addresses.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> XXH32_hash_t hash_seed;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>dict_entry {</div>
<div class="line">    <span class="keywordtype">char</span>            *hostname;</div>
<div class="line">    <span class="keyword">struct </span>in_addr  addr;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">uint32_t dict_hash(<span class="keyword">const</span> <span class="keywordtype">void</span> *restrict key, <span class="keywordtype">void</span> *restrict context)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> XXH32_hash_t *seed = context;</div>
<div class="line">    <span class="keywordflow">return</span> XXH32(key, strlen(key), *context);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">_Bool dict_eq(<span class="keyword">const</span> <span class="keywordtype">void</span> *restrict key, <span class="keyword">const</span> <span class="keywordtype">void</span> *restrict entry,</div>
<div class="line">            <span class="keywordtype">void</span> *restrict)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span>my_entry *e = entry;</div>
<div class="line">    <span class="keywordflow">return</span> strcmp(key, e-&gt;hostname) == 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> dict_free(<span class="keyword">const</span> <span class="keywordtype">void</span> *restrict entry, <span class="keywordtype">void</span> *restrict)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span>my_entry *e = entry;</div>
<div class="line">    free(e-&gt;hostname);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>sht_ht *dict(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>sht_ht *ht;</div>
<div class="line"> </div>
<div class="line">    getrandom(&amp;hash_seed, <span class="keyword">sizeof</span> hash_seed, 0);</div>
<div class="line">    ht = <a class="code hl_define" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0">SHT_NEW</a>(dict_hash, dict_eq, dict_free, <span class="keyword">struct</span> dict_entry);</div>
<div class="line">    <a class="code hl_function" href="sht_8c.html#a45747c22ee2656dcd16d86ce74ea5ec8">sht_set_hash_ctx</a>(ht, &amp;hash_seed);</div>
<div class="line">    <a class="code hl_function" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd">sht_init</a>(ht, 20);</div>
<div class="line">    <span class="keywordflow">return</span> ht;</div>
<div class="line">}</div>
<div class="ttc" id="asht_8c_html_a45747c22ee2656dcd16d86ce74ea5ec8"><div class="ttname"><a href="sht_8c.html#a45747c22ee2656dcd16d86ce74ea5ec8">sht_set_hash_ctx</a></div><div class="ttdeci">void sht_set_hash_ctx(struct sht_ht *ht, void *context)</div><div class="ttdoc">Set the &quot;context&quot; for a table&#39;s hash function.</div><div class="ttdef"><b>Definition</b> <a href="sht_8c_source.html#l00331">sht.c:331</a></div></div>
</div><!-- fragment --><p>Note:</p>
<ul>
<li>This example uses <a href="https://xxhash.com/doc/v0.8.3/group___x_x_h32__family.html"><span class="tt">XXH32()</span></a>, which requires a seed value. The hash function context is used to pass the seed to the hash function.</li>
<li>This hash table requires a "free function," in order to avoid leaking memory (host names) when entries are deleted. (See <a class="el" href="#memory-management">Memory management</a> below.)</li>
<li>The hash function context and the free function are two of several hash table attributes that can be set before the table is initialized. Attempting to set any of these attributes on a table that has been initialized is an API contract violation that will cause the program to abort.</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="memory-management"></a>
Memory management</h1>
<p>Table entries may contain pointers to other objects. (See <span class="tt">dict_entry.hostname</span> in the example above.) If such an entry is deleted from a table without freeing these objects, memory leaks can occur. If a table has a free function set, that function will be called whenever an entry is deleted from that table, in order to free that entry's associated resources.</p>
<p>The following operations can cause entries to be deleted.</p>
<ul>
<li><a class="el" href="sht_8c.html#a44c78b1e70265deda028ec34f6c2ecbd" title="Unconditionally set the value associated with a key.">sht_set()</a></li>
<li><a class="el" href="sht_8c.html#a195b40910c12c6dc21fbfc5b2f4c2716" title="Replace the entry associated with an existing key.">sht_replace()</a></li>
<li><a class="el" href="sht_8c.html#a16a6d148b8a1e9f24eeb56c3db568105" title="Remove an entry from the table.">sht_delete()</a></li>
<li><a class="el" href="sht_8c.html#ae36e072969cef119b1176887dcdc8623" title="Free the resources used by a hash table.">sht_free()</a></li>
<li><a class="el" href="sht_8c.html#a84cfd8fc36e1ba98ab427d82802ad420" title="Remove the last entry returned by a read/write iterator.">sht_iter_delete()</a></li>
<li><a class="el" href="sht_8c.html#a65154d9195575fab4ad984fbbcfaf13d" title="Replace the last entry returned by an iterator.">sht_iter_replace()</a></li>
</ul>
<p>(Operations such as <a class="el" href="sht_8c.html#a6d531c171c19475d113e6631ee23ef06" title="Exchange an existing entry and a new entry.">sht_swap()</a>, that return the entry being removed from the table, will not call the free function.)</p>
<p>Note that entry resources should not be automatically freed if they are still referenced elsewhere. Users of the library must take care to avoid both memory leaks and use-after-free bugs.</p>
<h1 class="doxsection"><a class="anchor" id="iterators"></a>
Iterators</h1>
<p>The library supports 2 iterator variations &mdash; read-only and read/write.</p>
<ul>
<li>Multiple read-only iterators can be exist on a table simultaneously, as long as no read/write iterator exists.</li>
<li>Only a single read/write iterator can exist on a table, and no read-only iterators can exist at the same time.</li>
<li>A read-only iterator cannot be used to delete entries from a table, but it can be used to replace entries (with other entries that have equal keys).</li>
<li>A read/write iterator can be used to replace or delete entries from a table.</li>
</ul>
<p>The table below summarizes these differences.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"></th><th class="markdownTableHeadCenter">Read-only  </th><th class="markdownTableHeadCenter">Read/write  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Multiple iterators?  </td><td class="markdownTableBodyCenter">YES  </td><td class="markdownTableBodyCenter">NO  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Replace entries?  </td><td class="markdownTableBodyCenter">YES  </td><td class="markdownTableBodyCenter">YES  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Delete entries?  </td><td class="markdownTableBodyCenter">NO  </td><td class="markdownTableBodyCenter">YES  </td></tr>
</table>
<p>Calling a function that may modify the structure of the table while any iterators (read-only or read/write) exist on the table will cause the library to abort the program. (See <a class="el" href="#abort-conditions">Abort conditions</a> below.)</p>
<blockquote class="doxtable">
<p><b>NOTE</b></p>
<p>The order in which an iterator returns the items in the table is effectively random, and it may change as entries are added to and removed from the table. </p>
</blockquote>
<h1 class="doxsection"><a class="anchor" id="error-handling"></a>
Error handling</h1>
<h2 class="doxsection"><a class="anchor" id="non-fatal-errors"></a>
Non-fatal errors</h2>
<p>Some of the functions (and macros) in this library return an error indication in some circumstances.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadCenter">Error return  </th><th class="markdownTableHeadCenter">Error info  </th><th class="markdownTableHeadNone">Error codes  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0" title="Create a new hash table.">SHT_NEW()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">NULL</span>  </td><td class="markdownTableBodyCenter">1  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>†  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">- <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">NULL</span>  </td><td class="markdownTableBodyCenter">1  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a53990568ace3dc2c06336b660e2ed76a" title="Entry size too large (&gt; 16KiB).">SHT_ERR_BAD_ESIZE</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd" title="Initialize a hash table.">sht_init()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyCenter">2  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a37247eba50bd8bcf928a3c658a70b858" title="Requested table size too large.">SHT_ERR_TOOBIG</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a5cd47d066198640b242e7a1ecebab92e" title="Add an entry to the table, if its key is not already present.">sht_add()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">-1</span>  </td><td class="markdownTableBodyCenter">2  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a37247eba50bd8bcf928a3c658a70b858" title="Requested table size too large.">SHT_ERR_TOOBIG</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7ab78a1ae652df8f6f7238d794c8d0ab51" title="Too many hash collisions.">SHT_ERR_BAD_HASH</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a44c78b1e70265deda028ec34f6c2ecbd" title="Unconditionally set the value associated with a key.">sht_set()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">-1</span>  </td><td class="markdownTableBodyCenter">2  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a37247eba50bd8bcf928a3c658a70b858" title="Requested table size too large.">SHT_ERR_TOOBIG</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7ab78a1ae652df8f6f7238d794c8d0ab51" title="Too many hash collisions.">SHT_ERR_BAD_HASH</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a82f0e05af3fc1174b3ff844ad1511362" title="Create a new iterator.">sht_iter_new()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">NULL</span>  </td><td class="markdownTableBodyCenter">2  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7ad64bd244886d31dd83f3d2900b3c082f" title="Can&#39;t acquire iterator lock.">SHT_ERR_ITER_LOCK</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a517a0ad602a27a475cc5cebc8f483a2a" title="Table has too many iterators.">SHT_ERR_ITER_COUNT</a></span>, <span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7a87b4856b631b1a7b906e9d6083dbd2a1" title="Memory allocation failed.">SHT_ERR_ALLOC</a></span>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a84cfd8fc36e1ba98ab427d82802ad420" title="Remove the last entry returned by a read/write iterator.">sht_iter_delete()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyCenter">3  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7abda0c65003c89740342a338a36b07663" title="Iterator at beginning or end.">SHT_ERR_ITER_NO_LAST</a></span>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a65154d9195575fab4ad984fbbcfaf13d" title="Replace the last entry returned by an iterator.">sht_iter_replace()</a>  </td><td class="markdownTableBodyCenter"><span class="tt">0</span>  </td><td class="markdownTableBodyCenter">3  </td><td class="markdownTableBodyNone"><span class="tt"><a class="el" href="sht_8h.html#a13c6debd7b2ee2b587a74957662713a7abda0c65003c89740342a338a36b07663" title="Iterator at beginning or end.">SHT_ERR_ITER_NO_LAST</a></span>  </td></tr>
</table>
<p>† <a class="el" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0" title="Create a new hash table.">SHT_NEW()</a> checks the entry size during compilation.</p>
<ol type="1">
<li><p class="startli">If an error occurs, <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a> stores an error code in the variable referenced by its <span class="tt">err</span> argument, provided that the value of <span class="tt">err</span> is not <span class="tt">NULL</span>. A description of the error can be retrieved with <a class="el" href="sht_8c.html#aa2bb68233ce1db0c4f1ba50fec4daa84" title="Get the description for an error code.">sht_msg()</a>.</p>
<p class="startli"><a class="el" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0" title="Create a new hash table.">SHT_NEW()</a> can be called with either 3 or 4 arguments. If a fourth argument is provided, it is used as the <span class="tt">err</span> argument in the internal call to <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a>. Otherwise, <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a> is called with its <span class="tt">err</span> argument set to <span class="tt">NULL</span>.</p>
</li>
<li>If an error occurs in a "table operation" function (a function that takes a pointer to a table as its first argument), the error code can be retrieved with <a class="el" href="sht_8c.html#a8a0fc3959fa6efaa802eeb84eab95c44" title="Get the error code of a table&#39;s last error.">sht_get_err()</a> (and passed to <a class="el" href="sht_8c.html#aa2bb68233ce1db0c4f1ba50fec4daa84" title="Get the description for an error code.">sht_msg()</a>), or an error description can be retrieved directly with <a class="el" href="sht_8c.html#aae2db74c56749b52273a6e6212d63a0c" title="Get a description of a table&#39;s last error.">sht_get_msg()</a>.</li>
<li>If an error occurs in an "iterator operator" function (a function that takes a pointer to an iterator as its first argument), the error code can be retrieved with SHT_ITER_ERR() (and passed to <a class="el" href="sht_8c.html#aa2bb68233ce1db0c4f1ba50fec4daa84" title="Get the description for an error code.">sht_msg()</a>), or an error description can be retrieved directly with SHT_ITER_MSG().</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="abort-conditions"></a>
Abort conditions</h2>
<p>As mentioned <a class="el" href="#design-philosophy">above</a>, the library takes a "fail fast" approach to API contract violations by the calling program. The library will <span class="tt">abort()</span> the calling program if any of the following occur.</p>
<ul>
<li>An invalid value is passed to <a class="el" href="sht_8c.html#aa2bb68233ce1db0c4f1ba50fec4daa84" title="Get the description for an error code.">sht_msg()</a>.</li>
<li>A <span class="tt">NULL</span> hash function or equality function pointer is passed to <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a>.</li>
<li><a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a> is called with an invalid <span class="tt">esize</span> or <span class="tt">ealign</span> argument. (This cannot occur if <a class="el" href="sht_8c.html#adb0d21d1b389094b3188be811ed5616c" title="(Create a new hash table.)">sht_new_()</a> is called via <a class="el" href="sht_8h.html#aff395306d3299b2e23d1ec5dfb0b70d0" title="Create a new hash table.">SHT_NEW()</a>.)<ul>
<li><span class="tt">ealign</span> must be a power of 2.</li>
<li><span class="tt">esize</span> must be a multiple of <span class="tt">ealign</span>.</li>
</ul>
</li>
<li>An invalid load factor threshold is passed to <a class="el" href="sht_8c.html#a99d607b370024be6526a17863ee62145" title="Set the load factor threshold for a table.">sht_set_lft()</a>.</li>
<li>An invalid PSL limit is passed to <a class="el" href="sht_8c.html#aa0790506e1bb1f4c3018feaa07d9fe62" title="Set the PSL limit of a table.">sht_set_psl_limit()</a>.</li>
<li><a class="el" href="sht_8c.html#a84cfd8fc36e1ba98ab427d82802ad420" title="Remove the last entry returned by a read/write iterator.">sht_iter_delete()</a> is called on a read-only iterator.</li>
<li>One of the functions in the table below is called on a table that is in an inappropriate state.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadCenter">Uninitialized  </th><th class="markdownTableHeadCenter">Initialized  </th><th class="markdownTableHeadCenter">Iterator(s) exist  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a45747c22ee2656dcd16d86ce74ea5ec8" title="Set the &quot;context&quot; for a table&#39;s hash function.">sht_set_hash_ctx()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a9d385ed61d95d30e63344ebe6aa522a3" title="Set the &quot;context&quot; for a table&#39;s equality function.">sht_set_eq_ctx()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#aae724bd6d23b2cc6921fe638c75c1b48" title="Set the &quot;context&quot; for a table&#39;s free function.">sht_set_free_ctx()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a99d607b370024be6526a17863ee62145" title="Set the load factor threshold for a table.">sht_set_lft()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#aa0790506e1bb1f4c3018feaa07d9fe62" title="Set the PSL limit of a table.">sht_set_psl_limit()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a4eaf764fc86d5f9428d6763f3aecadcd" title="Initialize a hash table.">sht_init()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter">†  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#ae36e072969cef119b1176887dcdc8623" title="Free the resources used by a hash table.">sht_free()</a>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a5cd47d066198640b242e7a1ecebab92e" title="Add an entry to the table, if its key is not already present.">sht_add()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a44c78b1e70265deda028ec34f6c2ecbd" title="Unconditionally set the value associated with a key.">sht_set()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a0dd66cb8cf354a570429662675bc6485" title="Lookup an entry in a table.">sht_get()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a82e02f941cacb73ed15c616bfe268985" title="Get the number of entries in a table.">sht_size()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a6ccef7db69da7e3394c146b0e5e63f42" title="Determine whether a table is empty.">sht_empty()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a16a6d148b8a1e9f24eeb56c3db568105" title="Remove an entry from the table.">sht_delete()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a826a9df51c8fe4ed3df707191ac6a105" title="Remove and return an entry from the table.">sht_pop()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a195b40910c12c6dc21fbfc5b2f4c2716" title="Replace the entry associated with an existing key.">sht_replace()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a6d531c171c19475d113e6631ee23ef06" title="Exchange an existing entry and a new entry.">sht_swap()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="sht_8c.html#a82f0e05af3fc1174b3ff844ad1511362" title="Create a new iterator.">sht_iter_new()</a>  </td><td class="markdownTableBodyCenter"><b>ABORT</b>  </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
</table>
<p>† Abort implied. (An iterator cannot be created on an uninitialized table.) </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
